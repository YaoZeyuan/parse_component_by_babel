æœ€è¿‘æ¥äº†ä¸ªéœ€æ±‚, éœ€è¦ç»Ÿè®¡å…¬å¸å‰ç«¯é¡¹ç›®ä¸­, è‡ªç ” npm åŒ…çš„æ™®åŠåº¦&åŒ…å†…å‡½æ•°ä½¿ç”¨é‡. è§£å†³è¿‡ç¨‹æ¯”è¾ƒæœ‰æ„æ€, è¿™é‡Œåˆ†äº«ä¸‹.

é¡¹ç›®çš„åŸºç¡€æ€è·¯æ¯”è¾ƒç®€å•, å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤º.

<!--
å›¾ç‰‡å†…å®¹:

1.  æ‹‰å–å…¬å¸æ‰€æœ‰å‰ç«¯é¡¹ç›®
2.  è§£æé¡¹ç›®ä¸­æ¯ä¸€ä¸ª js/jsx/ts/tsx æ–‡ä»¶, å¾—åˆ°æ¯ä¸ªæ–‡ä»¶ä¸­å¼•å…¥çš„ npm åŒ…åˆ—è¡¨. åŒ¹é…æ˜¯å¦ä¸ºè‡ªç ” npm åŒ….
    1.  è‹¥ä¸ºè‡ªç ” npm åŒ…, è·Ÿè¸ªè¢«å¯¼å…¥çš„åŒ…å†…å¯¼å‡ºå¯¹è±¡, ç»Ÿè®¡æ¯ä¸ªè¢«å¯¼å…¥å¯¹è±¡çš„ä½¿ç”¨æ¬¡æ•°
3.  npm åŒ…å¯¹ä½¿ç”¨æ•°æ®è¿›è¡Œæ±‡æ€». å­˜å…¥æ•°æ®åº“. ç¼–å†™æ¥å£, ä¾›å‰ç«¯å±•ç¤º
-->

![åŸºç¡€æµç¨‹](https://cdn.jsdelivr.net/gh/YaoZeyuan/parse_component_by_babel/doc/img/åŸºç¡€æµç¨‹.png)

å¯¹äºè·å–æ‰€æœ‰å‰ç«¯é¡¹ç›®é—®é¢˜, ç”±äºæˆ‘å¸æœ‰ä¸€å¥—è‡ªå»ºçš„å…¬å…±å‰ç«¯æ‰“åŒ…å¹³å°, å¯ä»¥ç›´æ¥è°ƒç”¨å¹³å°æ¥å£æ‹‰å–é¡¹ç›®æºç .

æ‰€ä»¥å‰©ä¸‹çš„éš¾ç‚¹åªæœ‰ä¸€ä¸ª: `å¦‚ä½•è§£æ js æ–‡ä»¶, å¾—åˆ°ç›®æ ‡ npm åŒ…å†…å¯¼å‡ºå¯¹è±¡çš„ä½¿ç”¨æ¬¡æ•°`.

å…¶å®æ–¹æ³•ä¹Ÿå¾ˆç®€å•: `babel æ€ä¹ˆåš, æˆ‘ä»¬å°±æ€ä¹ˆåš.`

ç”¨è¿‡ babel çš„äººéƒ½çŸ¥é“: babel å¯ä»¥è¯»å– ES6 ä»£ç , å…ˆå°† js æ–‡ä»¶æ•´ä½“è½¬åŒ–ä¸ºæŠ½è±¡è¯­æ³•æ ‘, ç„¶åéå†è¯­æ³•æ ‘, è°ƒç”¨æ’ä»¶å¯¹ä»£ç å†…å®¹è¿›è¡Œè°ƒæ•´, å‰”é™¤/è½¬æ¢è¯­æ³•ç»“æ„, å¹¶æœ€ç»ˆè¾“å‡ºä¸º ES5 ä»£ç . è€Œæˆ‘ä»¬éœ€è¦åšçš„, å°±æ˜¯ç¼–å†™ä¸€ä¸ªæ’ä»¶, åœ¨ babel éå†è¯­æ³•æ ‘æ—¶, è¯†åˆ«ç›®æ ‡ npm åŒ…, ç»Ÿè®¡ä»åŒ…ä¸­å¼•å‡ºçš„å˜é‡ä½¿ç”¨æƒ…å†µ. æµç¨‹å¦‚ä¸‹.

<!--
å›¾ç‰‡å†…å®¹:

1.  å¤„ç†å¯¼å…¥è¯­å¥, è·å–å¾…ç›‘æ§å˜é‡åˆ—è¡¨
    1.  æ•°æ®ç»“æ„: npm åŒ…å => éš¶å±äºè¯¥åŒ…çš„ä¸€çº§å¯¼å‡ºå˜é‡(import {useState, useRef} from "react")
2.  ç›‘æ§å¯¹å¯¼å‡ºå˜é‡çš„è§£æ„/é‡å‘½åæ“ä½œ
    1.  å¯¹ç”±å¯¼å‡ºå˜é‡ä¸­å¼•ç”³å‡ºçš„æ–°å˜é‡/é‡å‘½å, ç»Ÿä¸€è§†ä¸ºè¯¥å˜é‡çš„åˆ«å.
3.  ç»Ÿè®¡å¯¼å‡ºå˜é‡çš„ä½¿ç”¨æ¬¡æ•°
    1.  ä½œä¸ºå‡½æ•°ä½¿ç”¨
    2.  ä½œä¸ºå‚æ•°ä½¿ç”¨
-->

![è§£ææµç¨‹](https://cdn.jsdelivr.net/gh/YaoZeyuan/parse_compontent_by_babel/doc/img/è§£ææµç¨‹.png)

ç„¶åå‰©ä¸‹çš„å°±æ˜¯ä½“åŠ›æ´»: babel è§£æå‡ºçš„æ‰€æœ‰è¯­æ³•æ ‘èŠ‚ç‚¹ç±»å‹éƒ½åœ¨`babel-types`åŒ…ä¸­, éœ€è¦åšçš„, å°±æ˜¯é’ˆå¯¹åŒ…ä¸­çš„æ¯ä¸€ç§è¯­æ³•ç»“æ„(å¯¼å…¥/å˜é‡è§£æ„/é‡å‘½å/å‡½æ•°è°ƒç”¨/...)ç¼–å†™å¤„ç†å‡½æ•°, æœ€åå°†æ‰€æœ‰ç»“æœè¾“å‡ºä¸ºä¸€ä¸ª json.

ä»£ç æ¯”è¾ƒå†—é•¿, å…¨æ–‡å¯ä»¥ç¿»çœ‹è¿™ä¸ª[Github é¡¹ç›®](https://github.com/YaoZeyuan/parse_component_by_babel), è¿™é‡Œåªå±•ç¤ºä¸€ä¸‹ç”¨äºç»Ÿè®¡çš„æ•°æ®è§£æ„

### é¡¹ç›®æ•°æ®æ±‡æ€»: SummaryCollection

é’ˆå¯¹æ¯ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ª`SummaryCollection`å¯¹è±¡. è°ƒç”¨ add æ–¹æ³•ç™»è®°æ¯ä¸ªæ–‡ä»¶çš„è§£æç»“æœ

| å‡½æ•°ç­¾å                       | åŠŸèƒ½             | å¤‡æ³¨                         |
| ------------------------------ | ---------------- | ---------------------------- |
| constructor()                  | åˆå§‹åŒ–æ±‡æ€»ç±»     | æ±‡æ€»é¡¹ç›®å†…æ‰€æœ‰æ–‡ä»¶çš„åˆ†æè®°å½• |
| add(target: UsedSummaryInFile) | æ·»åŠ æ–‡ä»¶åˆ†ææ•°æ® |                              |
| toJson(): TypeUiLibReport[]    | è¾“å‡ºæ±‡æ€»ç»“æœ     |                              |

### æ–‡ä»¶æ•°æ®æ±‡æ€»: UsedSummaryInFile

é’ˆå¯¹å•ä¸ª js æ–‡ä»¶, ç»Ÿè®¡ç›®æ ‡ npm çš„ä½¿ç”¨è®°å½•

| å‡½æ•°ç­¾å | åŠŸèƒ½ | å¤‡æ³¨ |
| --- | --- | --- |
| constructor(fileUri: string) | åˆå§‹åŒ–æ–‡ä»¶åˆ†æè®°å½• | è®°å½•æ–‡ä»¶`fileUri`ä¸­çš„ npm åŒ…ä½¿ç”¨æ•°æ® |
| addLib(libName: string) | å‘ç°ç›®æ ‡ npm å, ç™»è®° npm åŒ…å |  |
| addLibAlias(libName: string, aliasName: string) | ç™»è®°ç›®æ ‡ npm åŒ…çš„åˆ«å |  |
| addComponent(libName: string, componentName: string) | ç™»è®°ç›®æ ‡ npm åŒ…ä¸‹ç»„ä»¶ |  |
| addComponentAlias(libName: string, componentName: string, componentNameAlias: string) | ç™»è®°ç›®æ ‡ npm åŒ…ä¸‹ç»„ä»¶çš„åˆ«å |  |
| incrComponentUseCount(libName: string, componentName: string) | npm åŒ…ä¸‹ç»„ä»¶ä½¿ç”¨æ¬¡æ•°+1 |  |
| incrLibUseCount(libName: string) | npm åŒ…ç›´æ¥ä½¿ç”¨æ¬¡æ•°+1 |  |
| isRegistedLibName(targetName: string) | æ£€æŸ¥æ˜¯å¦ç™»è®°è¿‡è¯¥ npm åŒ… |  |
| isRegistedComponentName(targetName: string) | æ£€æŸ¥æ˜¯å¦ç™»è®°è¿‡è¯¥ç»„ä»¶ |  |
| getComponentNameBelongToLib(targetName: string) | æ ¹æ®ç»„ä»¶å, æŸ¥æ‰¾å…¶éš¶å±çš„ npm åŒ…å |  |

### ç»Ÿè®¡ npm ä½¿ç”¨æƒ…å†µ: UsedLib

è®°å½• npm åŒ…ä½¿ç”¨è®°å½•, ä»¥åŠ npm åŒ…å†…ç»„ä»¶ä½¿ç”¨è®°å½•

| å‡½æ•°ç­¾å | åŠŸèƒ½ | å¤‡æ³¨ |
| --- | --- | --- |
| constructor(libName: string) | åˆå§‹åŒ– npm è®°å½•, npm åŒ…åä¸º`libName` | è®°å½• npm åŒ…ä½¿ç”¨æ•°æ® |
| addComponent(componentName: string) | ç™»è®° `libName` åŒ…ä¸­çš„ç»„ä»¶ | - |
| addComponentAlias(componentName: string, componentAliasName: string) | ç™»è®° `libName` åŒ…ä¸­ç»„ä»¶çš„åˆ«å | - |
| incrComponentUseCount(componentName: string, fileUri: string) | ç»„ä»¶åœ¨æ–‡ä»¶`fileUri`ä¸­ä½¿ç”¨æ¬¡æ•°+1 | - |
| incrLibUseCount(fileUri: string) | npm åº“åœ¨æ–‡ä»¶`fileUri`ä¸­ä½¿ç”¨æ¬¡æ•°+1 | npm åŒ…å¯èƒ½æœ¬èº«å°±æ˜¯ä¸€ä¸ªå‡½æ•° |
| isRegistedComponentName(testComponentName: string) | æ£€æŸ¥ç»„ä»¶å`testComponentName`æ˜¯å¦åœ¨`libName`åŒ…ä¸­æ³¨å†Œè¿‡ | - |

### ç»Ÿè®¡ç»„ä»¶ä½¿ç”¨æƒ…å†µ: UsedCompontent

è®°å½•ç»„ä»¶ä½¿ç”¨æ¬¡æ•°

| å‡½æ•°ç­¾å                        | åŠŸèƒ½                                        | å¤‡æ³¨             |
| ------------------------------- | ------------------------------------------- | ---------------- |
| constructor(name: string)       | åˆå§‹åŒ–ç»„ä»¶è®°å½•å¯¹è±¡, name ä¸ºè¢«ç»Ÿè®¡ç»„ä»¶çš„åå­— | è®°å½•ç»„ä»¶ä½¿ç”¨æ•°æ® |
| addAliasName(aliasName: string) | ç™»è®°ç»„ä»¶åˆ«å                                | -                |
| incrUseCount(fileUri: string)   | åœ¨æ–‡ä»¶`fileUri`ä¸­ä½¿ç”¨æ¬¡æ•°+1                 | -                |

# å‚è€ƒèµ„æ–™

ğŸ‘‡ ä»‹ç»äº† babel å¤„ç†è¯­æ³•æ ‘çš„æµç¨‹(Visitor æ¨¡å¼), æŠ½è±¡è¯­æ³•æ ‘æ¦‚å¿µ, babel å·¥ä½œåŸç†, å¿…è¯»

[æ·±å…¥ Babelï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†](https://juejin.cn/post/6844903746804137991)

ğŸ‘‡ åŒä¸Š, ä¹Ÿæ˜¯å¯¹ babel çš„ä»‹ç».

[å‰ç«¯å·¥ç¨‹å¸ˆéœ€è¦äº†è§£çš„ Babel çŸ¥è¯†](https://www.zoo.team/article/babel)

ğŸ‘‡ babel ä½¿ç”¨ `@babel/babel-parser` è§£æ js ä»£ç , è€Œ `@babel/babel-parser` åˆ™æ˜¯ fork çš„`acorn`. å¤„ç† babel ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘æ—¶, å¿…ç„¶éœ€è¦ç†è§£æ¯ä¸ªè¯­æ³•æ ‘èŠ‚ç‚¹ type å­—æ®µçš„å«ä¹‰(å¦‚`VariableDeclaration`, `ImportDefaultSpecifier`).

æ ‡å‡†æ–‡æ¡£åœ¨[è¿™é‡Œ](https://github.com/babel/babel/blob/master/packages/babel-parser/ast/spec.md), ä¸è¿‡æ˜¯è‹±æ–‡çš„, ä¸‹è¾¹æ˜¯ä¸€ä»½æ±‰è¯­ç‰ˆ, å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥å‚è€ƒ

[ä½¿ç”¨ Acorn æ¥è§£æ JavaScript](https://juejin.cn/post/6844903450287800327)

ğŸ‘‡ åœ¨çº¿å°† js ä»£ç è½¬æ¢ä¸º AST. ç¼–å†™ç›¸å…³ä»£ç æ—¶çš„å¿…å¤‡ä½³å“

[æŠ½è±¡è¯­æ³•æ ‘é¢„è§ˆ](https://astexplorer.net/)
